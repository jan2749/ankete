<!DOCTYPE html>
<html lang="sl">
<head>
  <meta charset="UTF-8">
  <title>Politične ankete - Volitve 2026</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f8f9fa;
    }
    header {
      background: #0d6efd;
      color: white;
      padding: 1rem;
      text-align: center;
    }
    nav {
      display: flex;
      background: #e9ecef;
      border-bottom: 1px solid #ccc;
    }
    nav button {
      flex: 1;
      padding: 1rem;
      border: none;
      background: inherit;
      cursor: pointer;
      font-size: 1rem;
    }
    nav button.active {
      background: white;
      border-bottom: 3px solid #0d6efd;
      font-weight: bold;
    }
    section {
      display: none;
      padding: 1.5rem;
    }
    section.active {
      display: block;
    }
    .card {
      background: white;
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .seat {
      display: flex;
      justify-content: space-between;
      max-width: 180px;
      padding: 2px 0;
    }
    .toggle {
      cursor: pointer;
      user-select: none;
      display: inline-flex;
      align-items: center;
      gap: .25rem;
    }
    .toggle::after {
      content: "▸";
      transition: transform .2s ease;
    }
    .toggle[aria-expanded="true"]::after {
      content: "▾";
    }
    .seats-content {
      display: none;
      flex-direction: row;
      align-items: flex-start;
    }
    .seats-content:not([hidden]) {
      display: flex;
      align-items: flex-start;
      position: relative;
    }
    .seats-list {
      flex: 1;
    }
    .chart {
      position: absolute;    
      top: -95px;         
      left: 280px;     
      width: 300px;
      height: 300px;
    }
    .support-content {
      display: none;
      flex-direction: row;
      align-items: flex-start;
    }
    .support-content:not([hidden]) {
      display: flex;
      align-items: flex-start;
      position: relative;
    }
    .support-list {
      flex: 1;
    }
    .support {
      display: flex;
      justify-content: space-between;
      max-width: 206px;
      padding: 2px 0;
    }
    .bar-chart {
      position: absolute;
      top: 10px;
      left: 220px;
      max-width: calc(85vw - 230px) !important;
    }
  </style>
</head>
<body>
  <header>
    <h1>Politične ankete - Volitve 2026</h1>
  </header>

  <nav>
    <button class="tab" data-tab="najnovejse">Najnovejše</button>
    <button class="tab active" data-tab="mediana">Mediana</button>
    <button class="tab" data-tab="ninamedia">Ninamedia</button>
    <button class="tab" data-tab="parsifal">Parsifal</button>
    <button class="tab" data-tab="ostali">Ostali</button>
  </nav>

  <main>
    <section id="najnovejse">
    </section>    
    <section id="mediana" class="active">
      <div class="card" data-date="2025-08-25"><h2>POP TV, 25.8.2025 *anketa z novimi strankami</h2><h3 class="toggle" role="button" tabindex="0" aria-expanded="false">Izračun sedežev</h3><div class="seats-content" hidden><div class="seats-list"><div class="seat"><span><b>SDS:</b></span><span>24</span></div><div class="seat"><span><b>GS:</b></span><span>17</span></div><div class="seat"><span><b>Demokrati:</b></span><span>13</span></div><div class="seat"><span><b>Prebilič stranka:</b></span><span>7</span></div><div class="seat"><span><b>SD:</b></span><span>7</span></div><div class="seat"><span><b>NSi:</b></span><span>6</span></div><div class="seat"><span><b>Resnica:</b></span><span>5</span></div><div class="seat"><span><b>Vesna:</b></span><span>5</span></div><div class="seat"><span><b>Levica:</b></span><span>4</span></div></div><canvas class="chart" width="300" height="300"></canvas></div><br><h3 class="toggle" role="button" tabindex="0" aria-expanded="false">Podpora opredeljenih</h3><div class="support-content" hidden><div class="support-list"><div class="support"><span><b>SDS:</b></span><span>22.85%</span></div><div class="support"><span><b>GS:</b></span><span>16.96%</span></div><div class="support"><span><b>Demokrati:</b></span><span>12.31%</span></div><div class="support"><span><b>Prebilič stranka:</b></span><span>7.11%</span></div><div class="support"><span><b>SD:</b></span><span>6.98%</span></div><div class="support"><span><b>NSi:</b></span><span>6.16%</span></div><div class="support"><span><b>Resnica:</b></span><span>4.65%</span></div><div class="support"><span><b>Vesna:</b></span><span>4.65%</span></div><div class="support"><span><b>Levica:</b></span><span>4.10%</span></div><div class="support"><span><b>SNS:</b></span><span>3.69%</span></div><div class="support"><span><b>Mi, Socialisti:</b></span><span>2.64%</span></div><div class="support"><span><b>Pirati:</b></span><span>1.92%</span></div><div class="support"><span><b>Glas upokojencev:</b></span><span>1.78%</span></div><div class="support"><span><b>SLS:</b></span><span>1.50%</span></div><div class="support"><span><b>Zaupanje:</b></span><span>1.09%</span></div><div class="support"><span><b>Fokus:</b></span><span>0.82%</span></div><div class="support"><span><b>S. Generacij:</b></span><span>0.41%</span></div><div class="support"><span><b>Zeleni:</b></span><span>0.41%</span></div><div class="support"><span><b>Suvereni:</b></span><span>0.14%</span></div></div><canvas class="bar-chart"></canvas></div><br></div>
      <div class="card" data-date="2025-08-24"><h2>POP TV, 24.8.2025</h2><h3 class="toggle" role="button" tabindex="0" aria-expanded="false">Izračun sedežev</h3><div class="seats-content" hidden><div class="seats-list"><div class="seat"><span><b>SDS:</b></span><span>34</span></div><div class="seat"><span><b>GS:</b></span><span>24</span></div><div class="seat"><span><b>SD:</b></span><span>11</span></div><div class="seat"><span><b>NSi:</b></span><span>7</span></div><div class="seat"><span><b>Levica:</b></span><span>6</span></div><div class="seat"><span><b>Demokrati:</b></span><span>6</span></div></div><canvas class="chart" width="300" height="300"></canvas></div><br><h3 class="toggle" role="button" tabindex="0" aria-expanded="false">Podpora opredeljenih</h3><div class="support-content" hidden><div class="support-list"><div class="support"><span><b>SDS:</b></span><span>31.43%</span></div><div class="support"><span><b>GS:</b></span><span>22.08%</span></div><div class="support"><span><b>SD:</b></span><span>9.94%</span></div><div class="support"><span><b>NSi:</b></span><span>6.43%</span></div><div class="support"><span><b>Levica:</b></span><span>5.99%</span></div><div class="support"><span><b>Demokrati:</b></span><span>5.41%</span></div><div class="support"><span><b>Vesna:</b></span><span>3.80%</span></div><div class="support"><span><b>Resnica:</b></span><span>3.65%</span></div><div class="support"><span><b>SNS:</b></span><span>3.36%</span></div><div class="support"><span><b>Pirati:</b></span><span>2.05%</span></div><div class="support"><span><b>SLS:</b></span><span>2.05%</span></div><div class="support"><span><b>Zeleni:</b></span><span>0.29%</span></div></div><canvas class="bar-chart"></canvas></div><br></div>
    </section>
    <section id="ninamedia">
      <div class="card" data-date="2025-08-13"><h2>Dnevnik, 13.8.2025</h2><h3 class="toggle" role="button" tabindex="0" aria-expanded="false">Izračun sedežev</h3><div class="seats-content" hidden><div class="seats-list"><div class="seat"><span><b>SDS:</b></span><span>33</span></div><div class="seat"><span><b>GS:</b></span><span>24</span></div><div class="seat"><span><b>SD:</b></span><span>10</span></div><div class="seat"><span><b>NSi:</b></span><span>8</span></div><div class="seat"><span><b>Levica:</b></span><span>7</span></div><div class="seat"><span><b>Demokrati:</b></span><span>6</span></div></div><canvas class="chart" width="300" height="300"></canvas></div><br><h3 class="toggle" role="button" tabindex="0" aria-expanded="false">Podpora opredeljenih</h3><div class="support-content" hidden><div class="support-list"><div class="support"><span><b>SDS:</b></span><span>35.59%</span></div><div class="support"><span><b>GS:</b></span><span>25.28%</span></div><div class="support"><span><b>SD:</b></span><span>11.11%</span></div><div class="support"><span><b>NSi:</b></span><span>8.53%</span></div><div class="support"><span><b>Levica:</b></span><span>7.57%</span></div><div class="support"><span><b>Demokrati:</b></span><span>6.28%</span></div><div class="support"><span><b>SLS:</b></span><span>0.48%</span></div><div class="support"><span><b>Vesna:</b></span><span>0.48%</span></div></div><canvas class="bar-chart"></canvas></div><br></div>
    </section>
    <section id="parsifal">
    </section>
    <section id="ostali">
      <div class="card" data-date="2025-08-27"><h2>Valicon za Siol, 27.8.2025</h2><h3 class="toggle" role="button" tabindex="0" aria-expanded="false">Izračun sedežev</h3><div class="seats-content" hidden><div class="seats-list"><div class="seat"><span><b>SDS:</b></span><span>27</span></div><div class="seat"><span><b>GS:</b></span><span>22</span></div><div class="seat"><span><b>SD:</b></span><span>10</span></div><div class="seat"><span><b>Demokrati:</b></span><span>8</span></div><div class="seat"><span><b>Resnica:</b></span><span>6</span></div><div class="seat"><span><b>Levica:</b></span><span>6</span></div><div class="seat"><span><b>NSi:</b></span><span>5</span></div><div class="seat"><span><b>Vesna:</b></span><span>4</span></div></div><canvas class="chart" width="300" height="300"></canvas></div><br><h3 class="toggle" role="button" tabindex="0" aria-expanded="false">Podpora opredeljenih</h3><div class="support-content" hidden><div class="support-list"><div class="support"><span><b>SDS:</b></span><span>24.89%</span></div><div class="support"><span><b>GS:</b></span><span>20.91%</span></div><div class="support"><span><b>SD:</b></span><span>8.86%</span></div><div class="support"><span><b>Demokrati:</b></span><span>7.73%</span></div><div class="support"><span><b>Resnica:</b></span><span>5.80%</span></div><div class="support"><span><b>Levica:</b></span><span>5.34%</span></div><div class="support"><span><b>NSi:</b></span><span>4.89%</span></div><div class="support"><span><b>Vesna:</b></span><span>4.09%</span></div><div class="support"><span><b>Pirati:</b></span><span>3.75%</span></div><div class="support"><span><b>SNS:</b></span><span>3.52%</span></div><div class="support"><span><b>Zeleni:</b></span><span>2.61%</span></div><div class="support"><span><b>SLS:</b></span><span>2.16%</span></div><div class="support"><span><b>Glas upokojencev:</b></span><span>1.82%</span></div></div><canvas class="bar-chart"></canvas></div><br></div>
    </section>
  </main>

  <script>
    // 🎨 
    const partyColors = {
      "SDS": "#effa19",
      "GS": "#163fc7",
      "SD": "#d91a37",
      "NSi": "#32aec9",
      "Levica": "#871737",
      "Demokrati": "#171287",
      "Resnica": "#a80fdb",
      "Prebilič stranka": "#093b0d",
      "Vesna": "#2a7530",
      "SNS": "#030102",
      "Mi, Socialisti": "#470b0f",
      "Pirati": "#b34e14",
      "Glas upokojencev": "#5c5ad6",
      "SLS": "#16c748",
      "Zaupanje": "#6316c7",
      "Fokus": "#1d02a8",
      "S. Generacij": "#00a67f",
      "Zeleni": "#10a802",
      "Suvereni": "#04240f"
    };

    // Tabs
    const buttons = document.querySelectorAll(".tab");
    const sections = document.querySelectorAll("section");

    buttons.forEach(btn => {
      btn.addEventListener("click", () => {
        buttons.forEach(b => b.classList.remove("active"));
        sections.forEach(s => s.classList.remove("active"));
        btn.classList.add("active");
        document.getElementById(btn.dataset.tab).classList.add("active");
      });
    });

    function initToggles() {
      document.querySelectorAll(".toggle").forEach(toggle => {
        const content = toggle.nextElementSibling;
        if (!content) return;

        content.hidden = true;
        toggle.addEventListener("click", () => {
          const willShow = content.hidden;
          content.hidden = !willShow;
          toggle.setAttribute("aria-expanded", String(willShow));
        });

        toggle.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            toggle.click();
          }
        });
      });
    }

    // Populate Najnovejše
    function populateLatestPolls() {
      const latestSection = document.getElementById("najnovejse");
      latestSection.innerHTML = ""; // Clear existing content
      const allCards = Array.from(document.querySelectorAll("section:not(#najnovejse) .card"));

      // Posodobi data-date na podlagi datuma v h2 (format DD.M.YYYY)
      allCards.forEach(card => {
        const h2Text = card.querySelector('h2').innerText;
        const dateMatch = h2Text.match(/\d{1,2}\.\d{1,2}\.\d{4}/);
        if (dateMatch) {
          const [day, month, year] = dateMatch[0].split('.');
          const dateStr = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
          card.dataset.date = dateStr;
        }
      });

      const sortedCards = allCards.sort((a, b) => {
        const dateA = new Date(a.dataset.date);
        const dateB = new Date(b.dataset.date);
        return dateB - dateA; // Sort descending (newest first)
      });

      sortedCards.forEach(card => {
        const clonedCard = card.cloneNode(true);
        const sourceId = card.closest('section').id;
        const h2 = clonedCard.querySelector('h2');
        if (sourceId === 'mediana') {
          h2.textContent = `Mediana za ${h2.textContent}`;
        } else if (sourceId === 'ninamedia') {
          h2.textContent = `Ninamedia za ${h2.textContent}`;
        } else if (sourceId === 'parsifal') {
          h2.textContent = `Parsifal za ${h2.textContent}`;
        }
        // Za 'ostali' brez spremembe
        latestSection.appendChild(clonedCard);
      });
    }

    // Chart + barvni krogi
    function renderCharts() {
      document.querySelectorAll('.card').forEach((card, i) => {
        const seats = card.querySelectorAll('.seat');
        const labels = [];
        const data = [];
        const colors = [];

        seats.forEach(seat => {
          const name = seat.querySelector('span b').innerText.replace(':','');
          const value = parseInt(seat.querySelectorAll('span')[1].innerText);
          labels.push(name);
          data.push(value);
          colors.push(partyColors[name] || "#ccc");

          // dodaj barvni krog pred ime
          const circle = document.createElement("span");
          circle.style.display = "inline-block";
          circle.style.width = "12px";
          circle.style.height = "12px";
          circle.style.borderRadius = "50%";
          circle.style.backgroundColor = partyColors[name] || "#ccc";
          circle.style.marginRight = "6px";
          seat.querySelector("span").prepend(circle);
        });

        const canvas = card.querySelector('canvas.chart');
        if (canvas) {
          new Chart(canvas, {
            type: 'pie',
            data: {
              labels: labels,
              datasets: [{
                data: data,
                backgroundColor: colors
              }]
            },
            options: {
              responsive: false,
              plugins: {
                legend: { position: 'right' }
              }
            }
          });
        }

        const supports = card.querySelectorAll('.support');
        const supportLabels = [];
        const supportData = [];
        const supportColors = [];

        supports.forEach(support => {
          const name = support.querySelector('span b').innerText.replace(':','');
          const value = parseFloat(support.querySelectorAll('span')[1].innerText.replace('%',''));
          supportLabels.push(name);
          supportData.push(value);
          supportColors.push(partyColors[name] || "#ccc");

          // dodaj barvni krog pred ime
          const circle = document.createElement("span");
          circle.style.display = "inline-block";
          circle.style.width = "12px";
          circle.style.height = "12px";
          circle.style.borderRadius = "50%";
          circle.style.backgroundColor = partyColors[name] || "#ccc";
          circle.style.marginRight = "6px";
          support.querySelector("span").prepend(circle);
        });

        const barCanvas = card.querySelector('canvas.bar-chart');
        if (barCanvas) {
          const numParties = supportLabels.length;
          const barHeight = Math.min(30 * numParties, 500);
          barCanvas.style.height = `${barHeight}px`;
          const barThickness = Math.max(14, Math.min(14, barHeight / numParties * (window.innerWidth / 1440)));
          const maxSupport = Math.ceil(Math.max(...supportData));

          new Chart(barCanvas, {
            type: 'bar',
            data: {
              labels: supportLabels,
              datasets: [{
                label: 'Podpora (%)',
                data: supportData,
                backgroundColor: supportColors,
                barThickness: barThickness
              }]
            },
            options: {
              indexAxis: 'y',
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                x: { 
                  beginAtZero: true, 
                  max: maxSupport
                },
                y: {
                  ticks: {
                    autoSkip: false,
                    font: { size: 12 }
                  }
                }
              },
              plugins: {
                legend: { display: false }
              },
              layout: {
                padding: {
                  top: 10,
                  bottom: 10
                }
              }
            }
          });
        }
      });
    }

    // Initialize
    populateLatestPolls();
    initToggles();
    renderCharts();
  </script>
</body>
</html>
